<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Be My Valentine ‚ù§Ô∏è</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Inter:wght@400;700&display=swap" rel="stylesheet">

<style>
:root {
  --accent:#ff4d6d;
  --cursor-x:50%;
  --cursor-y:50%;
}

* {margin:0;padding:0;box-sizing:border-box;}

html, body {
  width:100%;
  height:100%;
  overflow:hidden;
  font-family:'Inter',sans-serif;
  background:#ff8fa3;
  display:flex;
  align-items:center;
  justify-content:center;
  touch-action: none;
}

#fluid-canvas {
  position:fixed;
  inset:0;
  z-index:0;
  pointer-events:none;
}

#bg-shader {
  position:fixed;
  inset:0;
  z-index:1;
  background: radial-gradient(circle at var(--cursor-x) var(--cursor-y),
    #ffb3c1 0%,
    #ff8fa3 40%,
    #fb6f92 100%);
}

.glass-surface {
  position:relative;
  z-index:10;
  width:min(450px, 90vw);
  padding:clamp(2rem, 5vw, 4rem);
  text-align:center;
  border-radius:40px;
  backdrop-filter: blur(25px);
  background: rgba(255,255,255,0.15);
  border:1px solid rgba(255,255,255,0.3);
  box-shadow:0 25px 50px rgba(0,0,0,0.2);
  animation: breathe 4s ease-in-out infinite;
}

@keyframes breathe {
  0%,100% { transform:scale(1); }
  50% { transform:scale(1.03); }
}

.face-box {
  width:clamp(100px, 25vw, 130px);
  height:clamp(100px, 25vw, 130px);
  background:white;
  border-radius:50%;
  margin:0 auto 2.5rem;
  position:relative;
  box-shadow:0 10px 30px rgba(255,77,109,0.3);
  animation: floatFace 3s ease-in-out infinite;
}

@keyframes floatFace {
  0%,100% { transform:translateY(0); }
  50% { transform:translateY(-6px); }
}

.eyes {
  display:flex;
  justify-content:center;
  gap:25px;
  padding-top:42px;
}

.eye {
  width:18px;
  height:18px;
  background:#333;
  border-radius:50%;
  position:relative;
  overflow:hidden;
  animation: blink 5s infinite;
}

@keyframes blink {
  0%,95%,100% { height:18px; }
  97% { height:2px; }
}

.pupil {
  width:7px;
  height:7px;
  background:white;
  border-radius:50%;
  position:absolute;
  top:3px;
  left:3px;
  transition:transform 0.1s linear;
}

.mouth {
  width:45px;
  height:12px;
  border-bottom:5px solid #333;
  border-radius:50%;
  margin:14px auto;
  transition:0.4s ease;
}

@media (hover: hover) {
  .face-box:hover .mouth {
    width:26px;
    height:26px;
    background:red;
    border:none;
    clip-path: polygon(50% 80%, 100% 30%, 80% 0, 50% 20%, 20% 0, 0 30%);
  }
}

.blush {
  position:absolute;
  width:22px;
  height:12px;
  background:rgba(255,77,109,0.3);
  border-radius:50%;
  top:72px;
  animation: blushPulse 2s infinite;
}

.blush.left { left:15px; }
.blush.right { right:15px; }

@keyframes blushPulse {
  0%,100%{opacity:0.3;}
  50%{opacity:0.7;}
}

.heart {
  position:absolute;
  font-size:20px;
  animation: floatHeart 4s linear forwards;
  pointer-events:none;
}

@keyframes floatHeart {
  from {transform:translateY(0) scale(0.5);opacity:1;}
  to {transform:translateY(-150px) scale(1.5);opacity:0;}
}

h1 {
  font-family:'Dancing Script',cursive;
  color:white;
  font-size:clamp(2rem, 8vw, 3.2rem);
  margin-bottom:2rem;
}

.controls {
  position:relative;
  height:80px;
  display:flex;
  gap:1rem;
  justify-content:center;
  align-items:center;
}

button {
  padding:clamp(12px, 3vw, 16px) clamp(30px, 8vw, 50px);
  border-radius:20px;
  border:none;
  font-size:clamp(1rem, 3vw, 1.2rem);
  font-weight:700;
  cursor:pointer;
  transition:0.4s cubic-bezier(0.34,1.56,0.64,1);
  touch-action: manipulation;
}

#yesBtn {
  background:white;
  color:var(--accent);
  position:relative;
  z-index:2;
}

#yesBtn:hover, #yesBtn:active {transform:scale(1.25) rotate(3deg);}

#noBtn {
  background:rgba(255,255,255,0.2);
  color:white;
  border:1px solid rgba(255,255,255,0.4);
  position:absolute;
  left:60%;
}

#success-layer {
  position:fixed;
  inset:0;
  display:none;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:50;
}

.panda {
  font-size:clamp(60px, 15vw, 100px);
  animation: jump 0.6s infinite alternate;
}

@keyframes jump {
  from { transform:translateY(0); }
  to { transform:translateY(-30px); }
}

#heart-rain {
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:100;
}
.rain-heart {
  position:absolute;
  font-size:30px;
  animation: rain 3s linear forwards;
}
@keyframes rain {
  from {transform:translateY(-50px) scale(0.5); opacity:1;}
  to {transform:translateY(110vh) scale(1.5); opacity:0;}
}

@media (max-width: 600px) {
  .controls { height:60px; }
  .glass-surface { padding:2rem 1.5rem; }
}
</style>
</head>

<body>

<canvas id="fluid-canvas"></canvas>
<div id="bg-shader"></div>

<div class="glass-surface" id="main-card">
  <div class="face-box" id="face">
    <div class="blush left"></div>
    <div class="blush right"></div>
    <div class="eyes">
      <div class="eye"><div class="pupil"></div></div>
      <div class="eye"><div class="pupil"></div></div>
    </div>
    <div class="mouth"></div>
  </div>

  <h1>Be my Valentine?</h1>

  <div class="controls">
    <button id="yesBtn">Yes</button>
    <button id="noBtn">No</button>
  </div>
</div>

<div id="success-layer">
  <div style="display:flex;gap:20px;">
    <div class="panda">üêº</div>
    <div class="panda">üêº</div>
  </div>
  <h1>I knew you'd say yes! ‚ù§Ô∏è</h1>
</div>

<div id="heart-rain"></div>

<script>
// UNIFIED POINTER HANDLING (mouse + touch)
let currentX = window.innerWidth / 2;
let currentY = window.innerHeight / 2;

function handlePointer(e) {
  const x = e.touches ? e.touches[0].clientX : e.clientX;
  const y = e.touches ? e.touches[0].clientY : e.clientY;
  
  currentX = x;
  currentY = y;
  
  document.documentElement.style.setProperty("--cursor-x", x + "px");
  document.documentElement.style.setProperty("--cursor-y", y + "px");
  
  const face = document.getElementById("face");
  const rect = face.getBoundingClientRect();
  const cx = rect.left + rect.width / 2;
  const cy = rect.top + rect.height / 2;
  
  document.querySelectorAll(".pupil").forEach(p => {
    const angle = Math.atan2(y - cy, x - cx);
    p.style.transform = `translate(${Math.cos(angle) * 6}px, ${Math.sin(angle) * 6}px)`;
  });
}

document.addEventListener("mousemove", handlePointer);
document.addEventListener("touchmove", handlePointer, { passive: true });
document.addEventListener("touchstart", handlePointer, { passive: true });

// NO BUTTON RUN (enhanced for mobile)
const noBtn = document.getElementById("noBtn");
const controlsBox = document.querySelector(".controls");

function moveNoButton() {
  const maxX = controlsBox.offsetWidth - noBtn.offsetWidth;
  const maxY = controlsBox.offsetHeight - noBtn.offsetHeight;
  
  noBtn.style.left = Math.random() * maxX + "px";
  noBtn.style.top = Math.random() * maxY + "px";
}

noBtn.addEventListener("mouseover", moveNoButton);
noBtn.addEventListener("touchstart", (e) => {
  e.preventDefault();
  moveNoButton();
}, { passive: false });

// HEART RAIN FUNCTION
function startHeartRain() {
  const container = document.getElementById("heart-rain");
  const interval = setInterval(() => {
    for (let i = 0; i < 5; i++) {
      const h = document.createElement("div");
      h.className = "rain-heart";
      h.textContent = "‚ù§Ô∏è";
      h.style.left = Math.random() * 100 + "vw";
      h.style.fontSize = (20 + Math.random() * 30) + "px";
      container.appendChild(h);
      setTimeout(() => h.remove(), 3000);
    }
  }, 200);
  setTimeout(() => clearInterval(interval), 4000);
}

// YES BUTTON
function handleYes() {
  document.getElementById("main-card").style.display = "none";
  document.getElementById("success-layer").style.display = "flex";
  startHeartRain();
}

document.getElementById("yesBtn").addEventListener("click", handleYes);
document.getElementById("yesBtn").addEventListener("touchend", (e) => {
  e.preventDefault();
  handleYes();
});

// ENHANCED WEBGL2 FLUID SHADER
const canvas = document.getElementById("fluid-canvas");
const gl = canvas.getContext("webgl2", { alpha: true, antialias: false });

if (!gl) {
  console.warn("WebGL2 not supported, using fallback");
} else {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  
  window.addEventListener("resize", () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    gl.viewport(0, 0, canvas.width, canvas.height);
  });

  // Vertex shader
  const vertexShaderSource = `#version 300 es
    in vec2 position;
    void main() {
      gl_Position = vec4(position, 0.0, 1.0);
    }
  `;

  // Fragment shader with fluid-like effect
  const fragmentShaderSource = `#version 300 es
    precision highp float;
    uniform vec2 resolution;
    uniform float time;
    uniform vec2 pointer;
    out vec4 fragColor;

    float noise(vec2 p) {
      return fract(sin(dot(p, vec2(12.9898, 78.233))) * 43758.5453);
    }

    void main() {
      vec2 uv = gl_FragCoord.xy / resolution;
      vec2 center = pointer / resolution;
      
      float dist = length(uv - center);
      float ripple = sin(dist * 20.0 - time * 3.0) * 0.5 + 0.5;
      ripple *= exp(-dist * 3.0);
      
      vec2 offset = uv - 0.5;
      float angle = atan(offset.y, offset.x);
      float radius = length(offset);
      
      float swirl = sin(radius * 8.0 - time + angle * 3.0) * 0.5 + 0.5;
      float n = noise(uv * 5.0 + time * 0.2);
      
      vec3 color1 = vec3(1.0, 0.7, 0.76); // #ffb3c1
      vec3 color2 = vec3(1.0, 0.56, 0.64); // #ff8fa3
      vec3 color3 = vec3(0.98, 0.44, 0.57); // #fb6f92
      
      vec3 col = mix(color2, color1, ripple * 0.3);
      col = mix(col, color3, swirl * 0.2 + n * 0.1);
      
      fragColor = vec4(col, 0.4);
    }
  `;

  function createShader(type, source) {
    const shader = gl.createShader(type);
    gl.shaderSource(shader, source);
    gl.compileShader(shader);
    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
      console.error(gl.getShaderInfoLog(shader));
      gl.deleteShader(shader);
      return null;
    }
    return shader;
  }

  const vertexShader = createShader(gl.VERTEX_SHADER, vertexShaderSource);
  const fragmentShader = createShader(gl.FRAGMENT_SHADER, fragmentShaderSource);

  const program = gl.createProgram();
  gl.attachShader(program, vertexShader);
  gl.attachShader(program, fragmentShader);
  gl.linkProgram(program);

  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
    console.error(gl.getProgramInfoLog(program));
  }

  const positionBuffer = gl.createBuffer();
  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
    -1, -1, 1, -1, -1, 1,
    -1, 1, 1, -1, 1, 1
  ]), gl.STATIC_DRAW);

  const positionLoc = gl.getAttribLocation(program, "position");
  const resolutionLoc = gl.getUniformLocation(program, "resolution");
  const timeLoc = gl.getUniformLocation(program, "time");
  const pointerLoc = gl.getUniformLocation(program, "pointer");

  gl.useProgram(program);
  gl.enableVertexAttribArray(positionLoc);
  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
  gl.vertexAttribPointer(positionLoc, 2, gl.FLOAT, false, 0, 0);

  gl.enable(gl.BLEND);
  gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);

  let startTime = Date.now();
  function draw() {
    const time = (Date.now() - startTime) * 0.001;
    
    gl.viewport(0, 0, canvas.width, canvas.height);
    gl.clearColor(0, 0, 0, 0);
    gl.clear(gl.COLOR_BUFFER_BIT);
    
    gl.uniform2f(resolutionLoc, canvas.width, canvas.height);
    gl.uniform1f(timeLoc, time);
    gl.uniform2f(pointerLoc, currentX, canvas.height - currentY);
    
    gl.drawArrays(gl.TRIANGLES, 0, 6);
    requestAnimationFrame(draw);
  }
  draw();
}
</script>
</body>
</html>
